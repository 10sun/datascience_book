from sklearn import ensemble
import seaborn as sns
import numpy as np
import matplotlib.pyplot as plt
from keras.models import Sequential
from keras.layers import Dense
from keras.wrappers.scikit_learn import KerasClassifier
from sklearn import metrics
from sklearn import model_selection
import random
from functools import partial
from collections import defaultdict

%matplotlib inline

def baseline_model(n):
    # create model
    model = Sequential()
    model.add(Dense(10, input_dim=10))
    for i in range(n):
        model.add(Dense(10, input_dim=10))
    model.add(Dense(2, activation='softmax'))
    model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
    return model

def automl_basic(X_train, X_test, y_train, y_test, baseline, max_layers, num_runs = 3):
    accuracy_scores = defaultdict(list)
    for layers in range(max_layers):
        print("Number of hidden layers", layers)
        for i in range(num_runs):
            deep_model = partial(baseline, layers)
            estimator = KerasClassifier(build_fn=deep_model, epochs=100, batch_size=5, verbose=0)
            estimator.fit(X_train, y_train)
            y_pred = estimator.predict(X_test)
            accuracy_scores[layers].append(metrics.accuracy_score(y_test, y_pred))
    return accuracy_scores

def choose_best_model(accuracy_scores, max_layers):
    best_acc = 0
    best_hidden_layers = 0
    for layers in range(max_layers):
        cur_acc = np.mean(accuracy_scores[layers])
        if cur_acc > best_acc:
            best_acc = cur_acc
            best_hidden_layers = layers
    return best_acc, best_hidden_layers

random.seed(1)

df = pd.read_csv("housepricedata.csv")
X = df.values[:,0:10]
y = df.values[:,10]
X_train, X_test, y_train, y_test = model_selection.train_test_split(X, y)
max_layers = 5
accuracy_scores = automl_basic(X_train, X_test, y_train, y_test, baseline_model, max_layers, num_runs=5)
best_acc, best_hidden_layers = choose_best_model(accuracy_scores, max_layers)
print("Optimal number of hidden layers", best_hidden_layers)
print("Optimal accuracy", best_acc)
from sklearn import ensemble
import seaborn as sns
import numpy as np
import matplotlib.pyplot as plt
from keras.models import Sequential
from keras.layers import Dense
from keras.wrappers.scikit_learn import KerasClassifier
from sklearn import metrics
from sklearn import model_selection
import random
from functools import partial
from collections import defaultdict

%matplotlib inline

def baseline_model(n):
    # create model
    model = Sequential()
    model.add(Dense(n, input_dim=10))
    model.add(Dense(n))
    model.add(Dense(2, activation='softmax'))
    model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
    return model

def automl_basic(X_train, X_test, y_train, y_test, baseline, min_neurons, max_neurons, num_runs = 5):
    accuracy_scores = defaultdict(list)
    for neurons in range(min_neurons, max_neurons):
        print("Number of hidden layers", neurons)
        for i in range(num_runs):
            deep_model = partial(baseline, neurons)
            estimator = KerasClassifier(build_fn=deep_model, epochs=100, batch_size=5, verbose=0)
            estimator.fit(X_train, y_train)
            y_pred = estimator.predict(X_test)
            accuracy_scores[neurons].append(metrics.accuracy_score(y_test, y_pred))
    return accuracy_scores

def choose_best_model(accuracy_scores, min_neurons, max_neurons):
    best_acc = 0
    best_neurons = 0
    for neurons in range(min_neurons, max_neurons):
        cur_acc = np.mean(accuracy_scores[neurons])
        if cur_acc > best_acc:
            best_acc = cur_acc
            best_neurons = neurons
    return best_acc, best_neurons

random.seed(1)

df = pd.read_csv("housepricedata.csv")
X = df.values[:,0:10]
y = df.values[:,10]
X_train, X_test, y_train, y_test = model_selection.train_test_split(X, y)
min_neurons = 8
max_neurons = 13 
accuracy_scores = automl_basic(X_train, X_test, y_train, y_test, baseline_model, min_neurons, max_neurons, num_runs=2)
best_acc, best_hidden_layers = choose_best_model(accuracy_scores, min_neurons, max_neurons)
print("Optimal number of hidden layers", best_hidden_layers)
print("Optimal accuracy", best_acc)
